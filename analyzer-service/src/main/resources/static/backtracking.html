<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!--<link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>买入策略回溯</title>
    <script src="https://img.hcharts.cn/jquery/jquery-1.8.3.min.js"></script>
    <script src="https://img.hcharts.cn/highcharts/highcharts.js"></script>
    <script src="https://img.hcharts.cn/highcharts/modules/exporting.js"></script>
    <script src="https://img.hcharts.cn/highcharts/modules/data.js"></script>
    <script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-suggest.js"></script>
    <script>
        var options = {
            chart: {
                renderTo: 'chart-container',
                type: 'spline'
            },
            title: {
                text: '买入策略回溯',
            },
            xAxis: {
                categories: []
            },
            series: [
                {
                    name: 'r1'
                },
                {
                    name: 'r2'
                }
            ]
        };

        function post() {
            var code = $("#code").val();
            $.getJSON('backtracking/' + code + '?startDate=2005-02-04', function (data) {
                options.xAxis.categories = data.category;
                options.series[0].data = data.r1;
                options.series[1].data = data.r2;
                var chart = new Highcharts.Chart(options);
            });
        }

        $(document).ready(function () {
            $("#code").bsSuggest({
                indexId: 0, //data.value 的第几个数据，作为input输入框的内容
                indexKey: 0, //data.value 的第几个数据，作为input输入框的内容
                allowNoKeyword: false, //是否允许无关键字时请求数据。为 false 则无输入时不执行过滤请求
                multiWord: true, //以分隔符号分割的多关键字支持
                separator: ",", //多关键字支持时的分隔符，默认为空格
                getDataMethod: "url", //获取数据的方式，总是从 URL 获取
                showHeader: false, //显示多个字段的表头
                ignorecase: true,
                showBtn: false, //不显示下拉按钮
                autoDropup: false, //自动判断菜单向上展开
                effectiveFieldsAlias: {code: "代码", name: "名称"},
                url: "http://127.0.0.1:8002/search?word=",
                fnProcessData: function (json) {
                    var index,
                        len,
                        data = {value: []};

                    if (!json || !json.symbols || !json.symbols.length) {
                        return false;
                    }

                    len = json.symbols.length;

                    for (index = 0; index < len; index++) {
                        data.value.push({
                            code: json.symbols[index].code,
                            name: json.symbols[index].name
                        });
                    }
                    console.log("股票搜索API: ", data);
                    return data;
                }
            })
                .on("onDataRequestSuccess", function (e, result) {
                    console.log("onDataRequestSuccess: ", result);
                })
                .on("onSetSelectValue", function (e, keyword, data) {
                    console.log("onSetSelectValue: ", keyword, data);
                })
                .on("onUnsetSelectValue", function () {
                    console.log("onUnsetSelectValue");
                });

        });




    </script>
</head>
<body>

<div class="container">
    <p></p>
    <div class="row">
        <div class="col-lg-6">
            股票代码
            <div class="input-group">
                <input type="text" class="form-control" id="code">
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <button onclick="post()" type="button" class="btn btn-dark"> 提交</button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <div id="chart-container" style="min-width:400px;height:400px"></div>
    <div class="message">
        初始资金100万。
    </div>
    <div class="message">
        r1版本：如果MACD大于0，并且价格大于30天均线，买入或者持有。如果MACD<0 或者 价格小于30天均线，卖出或者空仓。
    </div>

    <div class="message">
        r2版本：第一个交易日买入，并一直持有。
    </div>


</div>
</body>
</html>